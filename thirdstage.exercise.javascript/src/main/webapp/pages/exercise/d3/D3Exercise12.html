<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>D3.js Exercise</title>
<link rel="stylesheet" href="../../../styles/bootstrap/bootstrap.min.css">
<script type="text/javascript" src="../../../scripts/underscore/underscore.js"></script>
<script type="text/javascript" src="../../../scripts/jquery/js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="../../../scripts/bootstrap/bootstrap.min.js"></script>
<script type='text/javascript' src='../../../scripts/d3/d3.min.js'></script>
<script type='text/javascript' src='../../../scripts/moment/moment-with-langs.js'></script>


	<style type="text/css">
		body {
			margin-left:20px;
		}

		.chart .axis path, .chart .axis line{
			fill:none;
			stroke:black;
			shape-rendering:crispEdges;
		}

		.chart .axis text{
			font-family:sans-serif;
			font-size:11px;
		}
		
		.chart path{
			fill:none;
			stroke:black;
		}
		
	</style>
</head>
<body>


	<div class="panel-group" id="accordion">
		<div class="panel panel-default">
			<div class="pannel-heading">
				<h4 class="pannel-title">
					<a data-toggle="collapse" data-parent="#accordion" href="#chart">
					Exercise time scale
					</a>
				</h4>
			</div>
			<div id="chart" class="panel-collapse">
				<div id="controls" style="margin-top:10px">
					<button id="controla" type="button">Init</button>
					<button id="controlb" type="button">Remove right half</button>
					<button id="controlc" type="button">Remove right half and add double valued</button>
				</div>
			</div>
		</div>
	</div>


	<script>
	"use strict";

	var dimensions = {width : 800, height : 400};
	var paddings = {top : 20, right : 30, bottom : 40, left : 50};
	var area = {
		x : [paddings.left, dimensions.width - paddings.right],
		y : [dimensions.height - paddings.bottom, paddings.top]  //large value first !
	}
	var domains = {
		x : [new Date(2014,4,1,0,0,0), new Date(2014,4,1,0,2,0)],
		y : [0, 100]
	}
	var r = 3;
	var scales = {};
	var axis = {};
	var data = [];
	var line = {};
	var path = {};

	//create scales
	scales = {
		x : d3.time.scale().range(area.x).domain(domains.x),
		y : d3.scale.linear().range(area.y).domain(domains.y)
	}

	//create pannel
	d3.select("#chart").insert("svg", "div")
		.classed("chart", true)
		.attr("width", dimensions.width)
		.attr("height", dimensions.height);
		//.style("background-color", "white");

	axis = {
		x : d3.svg.axis().scale(scales.x).orient("bottom").ticks(10),
		y : d3.svg.axis().scale(scales.y).orient("left").ticks(10)
	}

	d3.select("#chart svg").append("g")
		.classed("axis x", true)
		.attr("transform", "translate(0, " + area.y[0] + ")")
		.call(axis.x);

	d3.select("#chart svg").append("g")
		.classed("axis y", true)
		.attr("transform", "translate(" + area.x[0] + ", 0)")
		.call(axis.y);

	function draw(){
		initData(data);

		line = d3.svg.line()
			.interpolate("linear")
			.x(function(d){ return scales.x(d[0])})
			.y(function(d){ return scales.y(d[1])});

		path = d3.select("#chart svg").append("path")
			.classed("path", true)
			.data([data])
			.attr("d", line(data));
	}

	function update(count){
		if(--count < 0) return; 

		updateData(data, 1);
		path.transition()
			.duration(1000).ease("linear")
			.attr("d", line)
			.each("end", function(){ update(count); });
	}

	function initData(data){
		var times = d3.time.seconds(domains.x[0], new Date(2014,4,1,0,1,0),
			d3.time.second);
		var i, n; //variables for loop
		
		for(i = 0, n = times.length; i < n; i++){
			data[i] = [times[i], getY()];
		}
	}	
	
	function updateData(data, second){
		var last = data[data.length - 1];
		data[data.length] = [moment(last[0]).add('second', 1).toDate(), getY()];
	}
	
	function getY(){
		return Math.round(domains.y[1]/2 + Math.random()*domains.y[1]/2);
	}

	draw();
	update(60);

	</script>





</body>
</html>