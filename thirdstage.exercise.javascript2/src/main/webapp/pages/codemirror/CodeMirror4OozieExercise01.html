<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Exercise on CodeMirror</title>

<!-- Bootstrap -->
<link href="../../css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" media="screen"
	href="../../lib/codemirror/lib/codemirror.css" />
<link rel="stylesheet" type="text/css" media="screen"
	href="../../lib/codemirror/addon/hint/show-hint.css" />

<style>
/* http://codemirror.net/doc/manual.html#styling */
.CodeMirror {
	width: 1000px;
	height: 400px;
	font-size: 1.0em;
	line-height: 1.5;
	border: thin solid darkblue;
}
</style>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
	<h1>Oozie Config Editor</h1>



	<div class="btn-group btn-group-right" id="codeAreaControl"
		style="text-align: right">
		<button type="button" class="btn btn-default format">Format</button>
		<button type="button" class="btn btn-default">Command2</button>
		<button type="button" class="btn btn-default">Command3</button>
	</div>

	<textarea id="codeArea"></textarea>



	<script type="text/javascript"
		src="../../js/vendor/jquery-1.10.1.min.js"></script>
	<script type='text/javascript'
		src='../../lib/codemirror/lib/codemirror.js'></script>
	<script type='text/javascript'
		src='../../lib/codemirror/addon/hint/show-hint.js'></script>
	<script type='text/javascript'
		src='../../lib/codemirror/addon/hint/xml-hint.js'></script>
	<script type='text/javascript'
		src='../../lib/codemirror/mode/xml/xml.js'></script>
	<script type='text/javascript' src='../../js/app.js'></script>

	<script type="text/javascript">
		function completeAfter(cm, pred) {
			var cur = cm.getCursor();
			if (!pred || pred())
				setTimeout(function() {
					if (!cm.state.completionActive)
						cm.showHint({
							completeSingle : false
						});
				}, 100);
			return CodeMirror.Pass;
		}

		function completeIfAfterLt(cm) {
			return completeAfter(
					cm,
					function() {
						var cur = cm.getCursor();
						return cm.getRange(
								CodeMirror.Pos(cur.line, cur.ch - 1), cur) == "<";
					});
		}

		function completeIfInTag(cm) {
			return completeAfter(
					cm,
					function() {
						var tok = cm.getTokenAt(cm.getCursor());
						if (tok.type == "string"
								&& (!/['"]/.test(tok.string
										.charAt(tok.string.length - 1)) || tok.string.length == 1))
							return false;
						var inner = CodeMirror.innerMode(cm.getMode(),
								tok.state).state;
						return inner.tagName;
					});
		}

		!function() {
			var oozieTags = app.getOozieTags("0.5");

			var config = {
				mode : "application/xml",
				indentUnit : 3,
				smartIndent : true,
				tabSize : 3,
				indentWithTabs : true,
				electricChars : true,
				lineWrapping : false,
				lineNumbers : true,
				showCursorWhenSelecting : true,
				autofocus : true,

				extraKeys : {
					"'<'" : completeAfter,
					"'/'" : completeIfAfterLt,
					"' '" : completeIfInTag,
					"'='" : completeIfInTag,
					"Ctrl-Space" : "autocomplete"
				},
				hint : CodeMirror.hint.xml,
				hintOptions : {
					schemaInfo : oozieTags
				}
			};

			var xmlEditor = CodeMirror.fromTextArea(document
					.getElementById('codeArea'), config);
			
			$("#codeAreaControl button.format").click(function(event){
				xmlEditor.execCommand("selectAll");
				xmlEditor.execCommand("indentAuto");
				xmlEditor.setSelection({ line : 0, ch : 0 });				
			});
			
		}();
	</script>

	<article>
		<h2>XML Autocomplete Demo</h2>
		<form>
			<textarea id="code" name="code">
				<!-- write some xml below -->
			</textarea>
		</form>

		<p>
			Press <strong>ctrl-space</strong>, or type a '' character to activate
			autocompletion. This demo defines a simple schema that guides
			completion. The schema can be customizedâ€”see the <a
				href="../doc/manual.html#addon_xml-hint">manual</a>.
		</p>

		<p>
			Development of the
			<code> xml-hint </code>
			addon was kindly sponsored by <a href="http://www.xperiment.mobi">www.xperiment.mobi</a>.
		</p>

		<script>
			var dummy = {
				attrs : {
					color : [ "red", "green", "blue", "purple", "white",
							"black", "yellow" ],
					size : [ "large", "medium", "small" ],
					description : null
				},
				children : []
			};

			var tags = {
				"!top" : [ "top" ],
				"!attrs" : {
					id : null,
					class : [ "A", "B", "C" ]
				},
				top : {
					attrs : {
						lang : [ "en", "de", "fr", "nl" ],
						freeform : null
					},
					children : [ "animal", "plant" ]
				},
				animal : {
					attrs : {
						name : null,
						isduck : [ "yes", "no" ]
					},
					children : [ "wings", "feet", "body", "head", "tail" ]
				},
				plant : {
					attrs : {
						name : null
					},
					children : [ "leaves", "stem", "flowers" ]
				},
				wings : dummy,
				feet : dummy,
				body : dummy,
				head : dummy,
				tail : dummy,
				leaves : dummy,
				stem : dummy,
				flowers : dummy
			};

			function completeAfter(cm, pred) {
				var cur = cm.getCursor();
				if (!pred || pred())
					setTimeout(function() {
						if (!cm.state.completionActive)
							cm.showHint({
								completeSingle : false
							});
					}, 100);
				return CodeMirror.Pass;
			}

			function completeIfAfterLt(cm) {
				return completeAfter(cm, function() {
					var cur = cm.getCursor();
					return cm.getRange(CodeMirror.Pos(cur.line, cur.ch - 1),
							cur) == "<";
				});
			}

			function completeIfInTag(cm) {
				return completeAfter(
						cm,
						function() {
							var tok = cm.getTokenAt(cm.getCursor());
							if (tok.type == "string"
									&& (!/['"]/.test(tok.string
											.charAt(tok.string.length - 1)) || tok.string.length == 1))
								return false;
							var inner = CodeMirror.innerMode(cm.getMode(),
									tok.state).state;
							return inner.tagName;
						});
			}

			var editor = CodeMirror.fromTextArea(document
					.getElementById("code"), {
				mode : "xml",
				lineNumbers : true,
				extraKeys : {
					"'<'" : completeAfter,
					"'/'" : completeIfAfterLt,
					"' '" : completeIfInTag,
					"'='" : completeIfInTag,
					"Ctrl-Space" : "autocomplete"
				},
				hintOptions : {
					schemaInfo : tags
				}
			});
		</script>
	</article>

</body>
</html>